# 新環境でのWebフォーム連携セットアップ手順

## 環境情報
- **新しいスプレッドシートID**: `1ouyWnRo70vg7GPjj3YNIEHm6ROrXU8GiQjOOHFsV-B_me3DXZLKFfxdK`
- **新しいGAS Web App URL**: `https://script.google.com/macros/s/AKfycbw6NcVtH5CWflOGGJYbIO5H07wwLHMVheRUVgGGyTd1QmGmpWmbDrkEnnneqkZDIFtB6g/exec`

## セットアップ手順

### 1. Google Apps Scriptの設定

1. **新しいスプレッドシートを開く**
   - ID: `1ouyWnRo70vg7GPjj3YNIEHm6ROrXU8GiQjOOHFsV-B_me3DXZLKFfxdK`

2. **Apps Scriptエディタを開く**
   - 「拡張機能」→「Apps Script」を選択

3. **コードを追加**
   - `新環境用_doPost_integration.gs`の内容を**すべて**コピー
   - Code.gsファイルに貼り付け（既存のコードがある場合は置き換え）

4. **重要な設定を確認・変更**
   - **シート名の確認**: `DB_NAME = 'シート1'`（実際のシート名に合わせて変更）
   - **通知メールアドレスの設定**: 
     ```javascript
     const notificationEmail = 'notification@example.com'; // ★ここを実際のメールアドレスに変更
     ```

5. **保存**
   - Ctrl+S または「プロジェクトを保存」ボタンをクリック

### 2. Webアプリのデプロイ

1. **デプロイ設定**
   - 「デプロイ」→「新しいデプロイ」を選択
   - 種類：「ウェブアプリ」を選択

2. **設定内容**
   - **説明**: 「Webフォーム連携」
   - **実行ユーザー**: 「自分」
   - **アクセスできるユーザー**: 「全員」

3. **デプロイ実行**
   - 「デプロイ」ボタンをクリック
   - 権限の承認が求められたら承認

4. **URLの確認**
   - デプロイ完了後に表示されるURLが以下と一致することを確認：
   - `https://script.google.com/macros/s/AKfycbw6NcVtH5CWflOGGJYbIO5H07wwLHMVheRUVgGGyTd1QmGmpWmbDrkEnnneqkZDIFtB6g/exec`

### 3. 動作確認

#### GAS側のテスト

1. **Apps Scriptエディタでテスト**
   - `testFunction`を選択して実行
   - コンソールで「テスト結果」を確認

2. **ブラウザでテスト**
   - Web App URLにアクセス
   - 以下のような応答が表示されることを確認：
   ```json
   {
     "status": "ok",
     "message": "出荷証明書作成依頼システムが正常に動作しています",
     "timestamp": "2025-01-31T..."
   }
   ```

#### Webフォームからのテスト

1. **public/index.htmlを開く**
   - ブラウザでファイルを開く

2. **テストデータ入力**
   - 各フィールドにテストデータを入力
   - 最低限必要な項目：
     - 会社名
     - 担当者名
     - 電話番号
     - 宛名
     - 商品情報（1つ以上）

3. **送信テスト**
   - 「送信」ボタンをクリック
   - 成功メッセージが表示されることを確認

4. **スプレッドシートの確認**
   - 新しいスプレッドシートを開く
   - データが追加されていることを確認

### 4. トラブルシューティング

#### エラーが発生する場合

1. **ブラウザの開発者ツール確認**
   - F12キーでコンソールを開く
   - エラーメッセージを確認

2. **一般的なエラーと対処法**

   - **「CORS」エラー**
     - GASのデプロイ設定で「アクセスできるユーザー」が「全員」になっているか確認
     - URLが正しいか確認

   - **「シートが見つかりません」エラー**
     - `DB_NAME`の値が実際のシート名と一致しているか確認

   - **500エラー**
     - GASのログを確認（「実行数」→「ログを表示」）
     - データ構造の不一致を確認

3. **GASのログ確認方法**
   - Apps Scriptエディタで「実行数」をクリック
   - 最新の実行を選択してログを確認

### 5. 本番運用前のチェックリスト

- [ ] 通知メールアドレスが正しく設定されている
- [ ] シート名（DB_NAME）が正しい
- [ ] Webフォームから正常に送信できる
- [ ] スプレッドシートにデータが追加される
- [ ] 管理番号が正しく生成される
- [ ] 通知メールが送信される（設定した場合）

### 6. 注意事項

- このコードは新規環境用のため、既存の処理（T2処理など）は含まれていません
- 必要に応じて既存のコードと統合してください
- スプレッドシートの列構造は既存のものと同じである必要があります