# 出荷証明書発行システム - プロジェクト設計書

## 概要
このプロジェクトは、出荷証明書の依頼から発行までを自動化するWebフォームシステムです。

## システム全体の流れ

### フェーズ1: 依頼受付と自動処理（実装完了）
1. **顧客操作**
   - Webフォーム（index.html）から出荷証明書の依頼を申請
   - 会社情報、商品情報（最大7商品）、必要書類、送付先情報を入力

2. **自動処理**
   - Google Apps Script（Code.gs）でデータを受信
   - スプレッドシートのデータベースに転記
   - 依頼内容のPDFを自動生成（Google Docs API使用）
   - 依頼者と社内通知先にメールで通知

### フェーズ2: 証明書作成と送付（GASで実装済み・動作確認完了）
1. **社内確認作業**
   - スプレッドシート上で依頼内容を確認
   - 問題なければ出荷証明書を作成

2. **証明書送付**
   - 最終確認後、PDFをメールで送信
   - 送付先（To/Cc/Bcc）に配信

## 技術構成

### フロントエンド
- HTML/CSS/JavaScript
- レスポンシブデザイン対応
- 入力確認画面付き

### バックエンド
- Google Apps Script
- Google Sheets（データベース）
- Google Docs API（PDF生成）
- Gmail API（メール送信）

### 主要機能
- LockServiceによる同時実行制御
- エラーハンドリングとリトライ機構
- 美しいレイアウトのPDF生成（1ページ収まり）
- 複数の添付書類対応
- 備考欄でのカスタム要望対応

## データベース構造
`checkfile/データーベース項目.txt`に定義された約70項目のフィールドを持つスプレッドシート

主要フィールド：
- 管理番号、申請日時、ステータス
- 会社情報（申請者・送付先）
- 商品情報（最大7商品分）
- 必要書類フラグ
- PDFリンク、送付履歴

## 現在の課題
既存のGASスプレッドシートにWebフォームからの依頼を追加した際にエラーが発生。
現在、Webフォームからのデータベース転記までの基本動作を確認中。

### エラー詳細
- 症状：Webページから既存GASスプレッドシートへの転記ができない
- 現在のWeb App URL: `https://script.google.com/macros/s/AKfycbwzKN2ZeLMYEhzNlPy1ZWRIIG7W95qHDjPUV8Ev8RxnKPY9HkfbuDId2hFaduZv3_y5/exec`

### 確認事項
1. 既存GASのWeb App URLが正しいか
2. 既存GASの公開設定（アクセス権限）
3. データフォーマットの互換性

## 開発履歴
- 2024年：初期実装
- PDF生成方式の変更：SpreadsheetApp → Google Docs API
- レイアウト最適化：複数ページ問題を解決し、1ページに収まるデザイン実現
- 本番環境対応完了

## 今後の作業
1. 既存GASスプレッドシートのエラー原因調査
2. Webフォームとの連携確認
3. 全体フローのテスト

## 重要なファイル
- `/workspaces/webform/index.html` - 依頼フォーム
- `/workspaces/webform/Code.gs` - メインのGASコード
- `/workspaces/webform/checkfile/データーベース項目.txt` - DB定義